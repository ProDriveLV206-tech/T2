
<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="js/firebase_init.js"></script>
  <script src="js/admin.js"></script>
  <style>
    body{background:#111;color:white;font-family:Arial;padding:20px}
    .panel{border:1px solid #333;padding:10px;margin:10px 0}
    input,button{padding:6px;margin:4px}
  </style>
</head>
<body>
  <h1>Admin Panel (Full Upgrade)</h1>

  <div class="panel">
    <h3>User Moderation</h3>
    <input id="uid" placeholder="User UID">
    <button onclick="banUser(uid.value)">Ban</button>
    <button onclick="unbanUser(uid.value)">Unban</button>
    <button onclick="muteUser(uid.value)">Mute</button>
    <button onclick="unmuteUser(uid.value)">Unmute</button>
    <button onclick="shadowbanUser(uid.value)">Shadowban</button>
    <button onclick="unshadowbanUser(uid.value)">Unshadowban</button>
    <button onclick="forceLogout(uid.value)">Force Logout</button>
  </div>

  <div class="panel">
    <h3>Chat Moderation</h3>
    <input id="room" placeholder="Room name">
    <button onclick="clearChat(room.value)">Clear Chat</button>
    <button onclick="deleteRoom(room.value)">Delete Room</button>
    <button onclick="lockRoom(room.value)">Lock Room</button>
    <button onclick="unlockRoom(room.value)">Unlock Room</button>
    <button onclick="setSlowmode(room.value,3000)">Slowmode 3s</button>
  </div>

  <div class="panel">
    <h3>Message Moderation</h3>
    <input id="msgRoom" placeholder="Room">
    <input id="msgId" placeholder="Message ID">
    <button onclick="deleteMessage(msgRoom.value,msgId.value)">Delete Message</button>
  </div>

  <div class="panel">
    <h3>Global Announcement</h3>
    <input id="announcement" placeholder="Text">
    <button onclick="globalAnnouncement(announcement.value)">Send</button>
  </div>

  <div class="panel">
    <h3>Server Control</h3>
    <button onclick="freezeServer()">Freeze Server</button>
    <button onclick="unfreezeServer()">Unfreeze Server</button>
  </div>

  <div class="panel">
    <h3>UI Settings</h3>
    <input id="accent" placeholder="Accent Color Hex">
    <button onclick="setAccentColor(accent.value)">Set Accent</button><br>
    <input id="bg" placeholder="Background URL">
    <button onclick="setBackground(bg.value)">Set Background</button><br>
    <input id="logo" placeholder="Logo URL">
    <button onclick="setServerLogo(logo.value)">Set Logo</button><br>
    <input id="titleTxt" placeholder="Server Title">
    <button onclick="setServerTitle(titleTxt.value)">Set Title</button>
  </div>


<div class="panel">
  <h3>Permissions Matrix</h3>
  <p>Define permissions per role (simple keys):</p>
  <textarea id="permJson" style="width:100%;height:120px">{ "owner": ["all"], "admin": ["ban","mute","delete","createRoom"], "mod": ["mute","delete"], "user": [] }</textarea>
  <button onclick="savePerms()">Save Permissions</button>
  <button onclick="loadPerms()">Load Permissions</button>
</div>
<script>
async function savePerms(){
  try{
    const obj = JSON.parse(document.getElementById('permJson').value);
    await firebase.database().ref('role_permissions').set(obj);
    alert('Saved');
  }catch(e){ alert('Invalid JSON'); }
}
async function loadPerms(){
  const snap = await firebase.database().ref('role_permissions').once('value');
  const v = snap.val() || {};
  document.getElementById('permJson').value = JSON.stringify(v, null, 2);
}
</script>


<div class="panel">
  <h3>Live Sessions</h3>
  <div id="sessionsList" style="max-height:200px;overflow:auto;background:#000;padding:8px;color:#9f9"></div>
  <button onclick="loadSessions()">Refresh Sessions</button>
</div>
<script>
async function loadSessions(){
  const snap = await firebase.database().ref('presence').once('value');
  const el = document.getElementById('sessionsList'); el.innerHTML='';
  const v = snap.val()||{};
  Object.keys(v).forEach(k=>{
    const u=v[k];
    const div=document.createElement('div');
    div.textContent=(u.displayName||k)+' — online:'+ (!!u.online) + ' — last:'+ (new Date(u.lastSeen||0).toLocaleString());
    const btn=document.createElement('button'); btn.textContent='Force Logout'; btn.onclick=async ()=>{ if(confirm('Force logout '+k+'?')){ await firebase.database().ref('force_logout/'+k).set(true); alert('Signaled'); }};
    div.appendChild(btn);
    el.appendChild(div);
  });
}
</script>

<p><a href="admin-chat.html">Open Admin Chat</a></p>
</body>
</html>
